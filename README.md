# face_detection
基于 YOLOv11 的视频人脸检测工具，能够从视频文件中自动检测、提取并保存人脸图像，同时记录人脸出现的时间戳信息。该工具采用批处理方式高效处理视频帧，支持 GPU 加速，适用于视频内容分析、人脸识别前处理等场景。
## 功能特点

- **高效人脸检测**：使用 YOLOv11 模型进行快速准确的人脸检测
- **批量处理**：采用批处理方式高效处理视频帧
- **GPU 加速**：支持 CUDA 加速，提高处理速度
- **时间戳记录**：记录每个人脸出现的精确时间
- **进度可视化**：使用进度条显示处理进度
- **结果导出**：将检测结果保存为图像文件和 CSV 格式的记录

## 安装说明

### 环境要求

- Python 3.8 或更高版本
- CUDA 支持（可选，用于 GPU 加速）

### 依赖库

```bash
pip install opencv-python torch ultralytics tqdm numpy
```

### 模型文件

项目需要 YOLOv11 人脸检测模型文件 `yolov11n-face.pt`，请确保该文件位于项目根目录下。

## 使用方法

1. 将待处理的视频文件放置在项目目录下，默认文件名为 `1.mp4`
2. 运行主程序：

```bash
python face_detection.py
```

3. 程序将自动处理视频并在 `detected_faces` 目录下保存检测到的人脸图像
4. 检测结果将记录在 `face_records.txt` 文件中

## 输出说明

### 人脸图像

检测到的人脸图像将保存在 `detected_faces` 目录下，文件名格式为：
```
face_{序号:04d}_time_{分钟}_{秒}.jpg
```

### 记录文件

`face_records.txt` 文件包含以下信息：
- 人脸ID：检测到的人脸序号
- 时间(MM:SS)：人脸出现的分钟和秒数
- 时间戳(秒)：从视频开始计算的秒数
- 置信度：检测的置信度分数
- 图片路径：对应人脸图像的保存路径

## 参数调整

您可以在 `face_detection.py` 文件中调整以下参数：

- `confidence_threshold`：人脸检测的置信度阈值（默认为 0.5）
- `batch_size`：批处理的帧数（默认为 8）
- `sample_interval`：采样间隔，即每隔多少帧处理一次（默认为 8）

## 技术实现

- 使用 OpenCV 读取视频帧
- 采用 YOLOv11 模型进行人脸检测
- 使用 PyTorch 进行模型推理
- 通过批处理方式提高处理效率
- 使用多线程优化性能

## 注意事项

- 处理大型视频文件可能需要较长时间
- GPU 加速需要安装 CUDA 和对应版本的 PyTorch
- 检测效果受视频质量、人脸角度、光线等因素影响

## 许可证

[MIT License](https://opensource.org/licenses/MIT)
